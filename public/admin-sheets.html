<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#667eea">
    <title>Sheet Management - Admin - AI Financial Analyst</title>
    <link rel="stylesheet" href="styles.css?v=20251217-4">
</head>
<body>
    <div class="container">
        <header>
            <h1>üóÇÔ∏è Sheet Management</h1>
            <nav class="auth-section">
                <a href="index.html">Home</a>
                <a href="profile.html">Profile</a>
                <a href="admin.html">Admin Dashboard</a>
                <a href="admin-sheets.html" class="active">Sheet Management</a>
                <a href="admin-review.html">Review Queue</a>
                <button id="logout-btn" class="btn-secondary">Logout</button>
            </nav>
        </header>

        <!-- Loading State -->
        <div id="loading" class="loading-state" style="display: none;">
            <div class="spinner"></div>
            <p>Loading...</p>
        </div>

        <!-- Access Denied Message -->
        <div id="access-denied" class="error-message" style="display: none;">
            <h2>‚ùå Access Denied</h2>
            <p>You must be an admin to access this page.</p>
            <a href="index.html" class="btn-primary">Go to Home</a>
        </div>

        <!-- Main Content -->
        <div id="main-content" style="display: none;">
            <!-- Sheet Configurations List -->
            <section class="card">
                <div class="section-header">
                    <h2>üìä Sheet Configurations</h2>
                    <button id="create-sheet-btn" class="btn-primary">+ Create New Sheet Config</button>
                </div>
                
                <div id="sheets-list" class="sheets-list">
                    <!-- Populated by JavaScript -->
                </div>
            </section>
        </div>

        <!-- Create/Edit Sheet Config Modal -->
        <div id="sheet-config-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="modal-title">Create Sheet Configuration</h2>
                    <button class="modal-close" id="modal-close-btn">&times;</button>
                </div>
                
                <form id="sheet-config-form">
                    <div class="form-group">
                        <label for="config-name">Name *</label>
                        <input type="text" id="config-name" required placeholder="e.g., Entity A Sheet" maxlength="100">
                        <small>A descriptive name for this sheet configuration</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="config-sheet-id">Google Sheet ID *</label>
                        <input type="text" id="config-sheet-id" required placeholder="1gc-R5cKCOVFnnC0EsVJ...">
                        <small>The ID from the Google Sheets URL (between /d/ and /edit)</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="config-main-tab">Main Tab Name</label>
                        <input type="text" id="config-main-tab" placeholder="Sheet1 (default)">
                        <small>Leave blank to auto-detect the first sheet</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="config-accountant-tab">Accountant Tab Name</label>
                        <input type="text" id="config-accountant-tab" placeholder="Accountant_CSV_Ready (default)">
                        <small>Tab for simplified accountant-ready CSV format</small>
                    </div>
                    
                    <div class="form-group checkbox-group">
                        <label>
                            <input type="checkbox" id="config-default">
                            <span>Set as default sheet</span>
                        </label>
                        <small>New users without assignments will use this sheet</small>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" id="cancel-btn" class="btn-secondary">Cancel</button>
                        <button type="button" id="verify-sheet-btn" class="btn-secondary">üîç Verify Sheet</button>
                        <button type="submit" class="btn-primary">üíæ Save Configuration</button>
                    </div>
                </form>
                
                <div id="verification-result" class="verification-result" style="display: none;"></div>
            </div>
        </div>

        <!-- Sheet Assignment Modal -->
        <div id="sheet-assignment-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Assign Sheet: <span id="assign-sheet-name"></span></h2>
                    <button class="modal-close" id="assignment-modal-close-btn">&times;</button>
                </div>
                
                <div class="tabs">
                    <button class="tab-btn active" data-tab="assign-users">üë• Assign to Users</button>
                    <button class="tab-btn" data-tab="assign-entities">üè¢ Assign to Entities</button>
                    <button class="tab-btn" data-tab="view-assignments">üìã View Assignments</button>
                </div>
                
                <!-- Assign to Users Tab -->
                <div id="assign-users" class="tab-content active">
                    <div class="form-group">
                        <label for="user-select">Select Users</label>
                        <select id="user-select" multiple size="10">
                            <!-- Populated by JavaScript -->
                        </select>
                        <small>Hold Ctrl/Cmd to select multiple users ‚Ä¢ Shift to select range</small>
                    </div>
                    <div class="form-actions">
                        <button id="assign-users-btn" class="btn-primary">‚úì Assign Selected Users</button>
                    </div>
                </div>
                
                <!-- Assign to Entities Tab -->
                <div id="assign-entities" class="tab-content" style="display: none;">
                    <div class="form-group">
                        <label for="entity-select">Select Entity</label>
                        <select id="entity-select">
                            <option value="">-- Select an entity --</option>
                            <!-- Populated by JavaScript -->
                        </select>
                        <small>All users in this entity will use this sheet</small>
                    </div>
                    <div class="form-actions">
                        <button id="assign-entity-btn" class="btn-primary">‚úì Assign Entity</button>
                    </div>
                </div>
                
                <!-- View Assignments Tab -->
                <div id="view-assignments" class="tab-content" style="display: none;">
                    <h3>üë• Users Assigned:</h3>
                    <div id="assigned-users-list" class="assignment-list">
                        <div class="loading-state"><div class="spinner"></div><p>Loading...</p></div>
                    </div>
                    
                    <h3>üè¢ Entities Assigned:</h3>
                    <div id="assigned-entities-list" class="assignment-list">
                        <div class="loading-state"><div class="spinner"></div><p>Loading...</p></div>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button id="close-assignment-modal-btn" class="btn-secondary">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFunctions, httpsCallable } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-functions.js';
        import { getFirestore, collection, getDocs, query, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
        import firebaseConfig from './firebase-config.js';
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const functions = getFunctions(app, 'us-central1');
        const db = getFirestore(app);
        
        window.auth = auth;
        window.functions = functions;
        window.db = db;
        window.signOut = signOut;
        window.httpsCallable = httpsCallable;
        window.getDocs = getDocs;
        window.collection = collection;
        window.query = query;
        window.orderBy = orderBy;
    </script>
    <script src="admin-sheets.js?v=20251217"></script>
</body>
</html>

